import { motion, useMotionValue, useSpring, useTransform } from "framer-motion";
import { useRef, useEffect } from "react";
import { useCursorStore } from "../store/useCursorStore";

type Props = {
    show: boolean,
    setShow: React.Dispatch<React.SetStateAction<boolean>>;
}

export default function Roles({ show, setShow }: Props) {
    const progress = useMotionValue(0);
    const isHolding = useRef<boolean>(false);
    const CIRCUM = Math.PI * 160;

    const set = useCursorStore((state) => state.setCursorType);

    // unhold progress
    const smoothProgress = useSpring(progress, { stiffness: 100, damping: 20 });

    // progress to dashoffset
    const strokeDashoffset = useTransform(smoothProgress, [0, 1], [CIRCUM, 0]);

    useEffect(() => {
        let interval: number;

        const update = () => {
            const currentVal = progress.get();

            if (currentVal >= 1) {
                setShow(true);
                set("default");
                return;
            }

            if (isHolding.current) {
                const nextVal = Math.min(currentVal + 0.01, 1);
                progress.set(nextVal);
                if (nextVal >= 1) {
                    setShow(true);
                    set("default");
                }
            } else {
                progress.set(Math.max(currentVal - 0.02, 0));
            }
            interval = requestAnimationFrame(update);
        }

        interval = requestAnimationFrame(update);
        return () => cancelAnimationFrame(interval);
    }, [progress]);

    return (
        <motion.div className="relative flex items-center justify-center w-[200px] h-[200px]">
            <svg
                width="200"
                height="200"
                viewBox="0 0 250 250"
                xmlns="http://www.w3.org/2000/svg"
                className="absolute mix-blend-difference z-[10]"
            >
                <motion.g
                    animate={{ rotate: 360 }}
                    transition={{ 
                        duration: 15, 
                        repeat: Infinity, 
                        ease: "linear" 
                    }}
                >
                    <path d="M222.818 131.267L223.172 126.793L237.672 127.939L237.303 132.612C237.192 134.018 236.806 135.199 236.146 136.154C235.492 137.109 234.603 137.81 233.479 138.258C232.361 138.707 231.051 138.871 229.55 138.753C228.04 138.633 226.761 138.262 225.713 137.637C224.67 137.013 223.896 136.164 223.392 135.089C222.893 134.014 222.702 132.74 222.818 131.267ZM224.591 128.672L224.385 131.277C224.29 132.476 224.443 133.488 224.843 134.313C225.243 135.137 225.855 135.777 226.679 136.232C227.503 136.686 228.505 136.96 229.685 137.054C230.855 137.146 231.878 137.035 232.753 136.719C233.633 136.404 234.33 135.884 234.843 135.16C235.361 134.436 235.664 133.508 235.754 132.375L235.976 129.571L224.591 128.672Z" fill="white"/>
                    <path d="M219.895 150.092L233.787 154.404L231.185 162.788L229.693 162.325L231.773 155.623L227.079 154.166L225.134 160.434L223.641 159.97L225.587 153.703L220.865 152.238L218.752 159.048L217.26 158.585L219.895 150.092Z" fill="white"/>
                    <path d="M225.496 176.084L212.704 173.86L212.621 174.009L221.188 183.765L220.284 185.376L210.211 173.602L211.1 172.016L226.399 174.473L225.496 176.084Z" fill="white"/>
                    <path d="M200.86 187.366L211.68 197.087L205.813 203.617L204.651 202.573L209.34 197.353L205.684 194.069L201.298 198.95L200.136 197.906L204.522 193.024L200.845 189.721L196.079 195.025L194.917 193.981L200.86 187.366Z" fill="white"/>
                    <path d="M186.978 201.194L195.701 212.833L194.292 213.889L186.505 203.5L181.095 207.556L180.158 206.305L186.978 201.194Z" fill="white"/>
                    <path d="M163.516 223.377C162.871 221.985 162.564 220.666 162.597 219.419C162.63 218.172 162.957 217.071 163.578 216.115C164.199 215.159 165.073 214.42 166.198 213.898C167.324 213.376 168.452 213.187 169.583 213.331C170.715 213.474 171.766 213.937 172.739 214.717C173.712 215.498 174.521 216.585 175.166 217.976C175.811 219.368 176.117 220.687 176.085 221.934C176.052 223.181 175.725 224.282 175.104 225.239C174.482 226.195 173.609 226.934 172.483 227.455C171.358 227.977 170.229 228.166 169.098 228.023C167.967 227.879 166.915 227.417 165.942 226.636C164.97 225.855 164.161 224.769 163.516 223.377ZM165.062 222.66C165.592 223.803 166.23 224.679 166.977 225.287C167.719 225.898 168.508 226.255 169.344 226.358C170.176 226.463 170.991 226.331 171.79 225.96C172.589 225.59 173.219 225.053 173.681 224.348C174.138 223.646 174.376 222.813 174.393 221.849C174.407 220.888 174.149 219.836 173.619 218.693C173.09 217.551 172.453 216.674 171.711 216.063C170.964 215.454 170.175 215.097 169.344 214.992C168.508 214.889 167.69 215.023 166.891 215.393C166.092 215.763 165.464 216.3 165.007 217.002C164.546 217.707 164.308 218.54 164.294 219.501C164.277 220.464 164.533 221.517 165.062 222.66Z" fill="white"/>
                    <path d="M148.719 220.384L151.592 234.643L146.774 235.614C145.655 235.839 144.7 235.821 143.908 235.561C143.113 235.306 142.475 234.871 141.994 234.258C141.513 233.645 141.188 232.918 141.019 232.078C140.85 231.238 140.868 230.44 141.073 229.684C141.273 228.929 141.687 228.275 142.315 227.724C142.944 227.177 143.813 226.792 144.922 226.568L148.376 225.873L148.684 227.404L145.287 228.089C144.521 228.243 143.932 228.499 143.522 228.857C143.111 229.215 142.846 229.641 142.728 230.133C142.606 230.631 142.603 231.165 142.718 231.736C142.833 232.307 143.042 232.796 143.347 233.203C143.646 233.612 144.056 233.896 144.576 234.057C145.097 234.222 145.746 234.227 146.521 234.071L149.556 233.459L146.993 220.732L148.719 220.384Z" fill="white"/>
                    <path d="M128.349 223.211L128.217 237.755L119.438 237.676L119.453 236.113L126.469 236.177L126.514 231.262L119.952 231.203L119.966 229.64L126.528 229.7L126.573 224.757L119.443 224.692L119.457 223.13L128.349 223.211Z" fill="white"/>
                    <path d="M107.835 221.77L104.698 235.973L99.8993 234.914C98.7896 234.669 97.9207 234.278 97.2924 233.742C96.663 233.21 96.2498 232.578 96.0526 231.846C95.8555 231.114 95.8493 230.329 96.0341 229.493C96.2188 228.656 96.5538 227.951 97.0388 227.38C97.5239 226.808 98.161 226.415 98.95 226.202C99.7381 225.992 100.682 226.009 101.783 226.252L105.666 227.11L105.323 228.663L101.495 227.818C100.737 227.651 100.102 227.627 99.5907 227.747C99.0748 227.866 98.6678 228.105 98.3699 228.466C98.0664 228.831 97.8518 229.298 97.7263 229.866C97.6007 230.435 97.5973 230.955 97.716 231.428C97.8348 231.9 98.1021 232.303 98.5181 232.638C98.933 232.977 99.5242 233.231 100.292 233.4L103.315 234.068L106.115 221.39L107.835 221.77ZM99.7403 226.674L97.6538 219.522L99.6511 219.963L101.682 227.103L99.7403 226.674Z" fill="white"/>
                    <path d="M66.9268 212.727L67.7613 211.406L73.1413 214.805L72.3067 216.126L66.9268 212.727Z" fill="white"/>
                    <path d="M48.148 186.028L50.8731 189.595L39.3149 198.425L36.4691 194.7C35.6125 193.579 35.1109 192.443 34.9643 191.292C34.8139 190.143 35.0071 189.027 35.5439 187.944C36.0769 186.863 36.9416 185.866 38.1381 184.952C39.3421 184.032 40.5425 183.455 41.7393 183.22C42.9323 182.987 44.0755 183.103 45.1686 183.567C46.2581 184.034 47.2512 184.854 48.148 186.028ZM48.5622 189.144L46.9754 187.067C46.2453 186.111 45.4559 185.46 44.6071 185.113C43.7583 184.767 42.8756 184.699 41.9589 184.911C41.0422 185.123 40.1135 185.588 39.1729 186.307C38.2398 187.019 37.553 187.786 37.1123 188.605C36.6679 189.427 36.4965 190.279 36.5981 191.161C36.6959 192.045 37.0898 192.939 37.7797 193.842L39.4871 196.077L48.5622 189.144Z" fill="white"/>
                    <path d="M37.7435 170.068L24.5281 176.144L20.8609 168.168L22.2805 167.516L25.2119 173.891L29.6773 171.838L26.9357 165.875L28.3553 165.223L31.0969 171.185L35.5881 169.12L32.6091 162.641L34.0287 161.989L37.7435 170.068Z" fill="white"/>
                    <path d="M18.1384 146.499C17.4547 146.74 16.9851 147.199 16.7295 147.877C16.4739 148.556 16.4424 149.325 16.635 150.184C16.7758 150.812 17.0006 151.339 17.3095 151.765C17.6173 152.186 17.9787 152.489 18.3934 152.672C18.8072 152.851 19.2404 152.89 19.6932 152.789C20.0721 152.704 20.3776 152.541 20.6098 152.299C20.8364 152.055 21.0077 151.769 21.1237 151.442C21.2351 151.116 21.3133 150.783 21.3584 150.443C21.3989 150.104 21.4243 149.795 21.4346 149.516L21.4997 147.988C21.5139 147.596 21.5558 147.155 21.6253 146.664C21.6937 146.168 21.8292 145.679 22.0318 145.197C22.2286 144.712 22.5252 144.281 22.9216 143.906C23.3179 143.531 23.8487 143.269 24.514 143.12C25.281 142.948 26.0191 142.994 26.7283 143.257C27.4364 143.516 28.0589 143.988 28.5958 144.673C29.1316 145.353 29.5217 146.239 29.766 147.329C29.9937 148.346 30.0269 149.263 29.8656 150.08C29.7032 150.893 29.3762 151.577 28.8847 152.134C28.3921 152.686 27.7639 153.076 27.0001 153.306L26.6026 151.532C27.1282 151.365 27.5314 151.086 27.8121 150.693C28.0872 150.296 28.2559 149.836 28.3181 149.313C28.3747 148.786 28.3399 148.241 28.2136 147.677C28.0666 147.021 27.8283 146.456 27.4988 145.981C27.1646 145.508 26.7717 145.162 26.3199 144.943C25.8634 144.725 25.3765 144.674 24.859 144.789C24.3877 144.895 24.0338 145.113 23.7971 145.442C23.5604 145.772 23.3978 146.172 23.3092 146.643C23.2207 147.114 23.163 147.615 23.1362 148.145L23.0286 150.003C22.9582 151.184 22.6998 152.163 22.2534 152.943C21.8069 153.722 21.1055 154.219 20.1491 154.433C19.3544 154.611 18.6132 154.552 17.9255 154.255C17.2322 153.954 16.6397 153.475 16.1481 152.819C15.6508 152.159 15.3008 151.376 15.0979 150.47C14.8929 149.555 14.8747 148.705 15.0433 147.92C15.2073 147.136 15.5245 146.473 15.995 145.931C16.4645 145.385 17.0547 145.019 17.7657 144.836L18.1384 146.499Z" fill="white"/>
                    <path d="M12.5691 130.463L27.0975 129.76L27.1827 131.519L12.6542 132.222L12.5691 130.463Z" fill="white"/>
                    <path d="M18.6975 105.603C18.2016 105.688 17.7476 105.829 17.3356 106.027C16.9196 106.219 16.5526 106.469 16.2345 106.776C15.9171 107.079 15.656 107.438 15.4513 107.853C15.2466 108.267 15.1059 108.735 15.0293 109.255C14.9037 110.107 15.0096 110.915 15.3471 111.678C15.6845 112.441 16.2515 113.091 17.048 113.63C17.8445 114.168 18.8657 114.53 20.1117 114.713C21.3577 114.897 22.4401 114.843 23.3587 114.553C24.2774 114.262 25.0093 113.793 25.5546 113.146C26.0998 112.499 26.438 111.73 26.5692 110.84C26.6906 110.016 26.622 109.264 26.3632 108.585C26.1003 107.9 25.6716 107.334 25.0769 106.888C24.4783 106.436 23.7386 106.145 22.858 106.015L23.0491 105.497L22.4113 109.826L20.8655 109.598L21.6731 104.117L23.2189 104.345C24.404 104.52 25.3973 104.925 26.1987 105.56C27.0008 106.19 27.5779 106.983 27.9299 107.94C28.2779 108.891 28.3677 109.938 28.1993 111.081C28.0115 112.355 27.5468 113.43 26.805 114.307C26.0639 115.179 25.1009 115.803 23.9161 116.178C22.7319 116.549 21.3809 116.623 19.8632 116.4C18.725 116.232 17.7239 115.929 16.86 115.49C15.9921 115.047 15.2787 114.496 14.7198 113.84C14.1609 113.183 13.7671 112.445 13.5383 111.627C13.3096 110.808 13.2632 109.937 13.3992 109.015C13.511 108.256 13.73 107.565 14.0562 106.943C14.3783 106.316 14.7858 105.775 15.2787 105.322C15.7675 104.862 16.3255 104.502 16.9528 104.24C17.5753 103.978 18.2453 103.832 18.9625 103.804L18.6975 105.603Z" fill="white"/>
                    <path d="M22.351 78.6857L35.8509 84.1007L35.2163 85.6828L21.666 88.7875L21.6131 88.9193L32.2126 93.171L31.5569 94.8057L18.057 89.3907L18.6916 87.8087L32.2788 84.6882L32.3317 84.5563L21.7058 80.2941L22.351 78.6857Z" fill="white"/>
                    <path d="M42.1384 72.6867L30.1615 64.433L35.1427 57.2047L36.4293 58.0913L32.4475 63.8693L36.4944 66.6581L40.2183 61.2545L41.5048 62.1411L37.781 67.5448L41.8513 70.3497L45.8975 64.4782L47.1841 65.3649L42.1384 72.6867Z" fill="white"/>
                    <path d="M54.1896 57.2667L44.1748 46.718L47.7391 43.3341C48.5632 42.5517 49.3733 42.0502 50.1695 41.8298C50.9623 41.6059 51.7173 41.6171 52.4343 41.8635C53.1513 42.1098 53.8049 42.5438 54.395 43.1653C54.985 43.7868 55.3812 44.4585 55.5835 45.1805C55.7858 45.9025 55.7547 46.6502 55.4901 47.4237C55.2223 48.1938 54.6797 48.9667 53.8625 49.7426L50.9781 52.481L49.8827 51.3273L52.7259 48.628C53.289 48.0933 53.6641 47.5806 53.851 47.0898C54.0413 46.5957 54.0703 46.1242 53.9379 45.6753C53.8057 45.2198 53.5392 44.7808 53.1382 44.3584C52.7372 43.9361 52.3078 43.6419 51.8499 43.476C51.392 43.31 50.9082 43.3058 50.3983 43.4634C49.8853 43.6176 49.3437 43.9652 48.7737 44.5064L46.528 46.6384L55.467 56.0539L54.1896 57.2667ZM54.6561 47.814L61.7509 50.0881L60.2674 51.4964L53.2139 49.1832L54.6561 47.814Z" fill="white"/>
                    <path d="M85.3692 27.8494L85.9999 29.2789L80.1778 31.8477L79.547 30.4182L85.3692 27.8494Z" fill="white"/>
                    <path d="M114.17 27.6373L112.327 27.7433L116.823 12.9151L118.639 12.8107L124.806 27.0254L122.962 27.1315L117.92 15.157L117.806 15.1635L114.17 27.6373ZM114.525 21.9257L121.955 21.4982L122.045 23.0581L114.614 23.4856L114.525 21.9257Z" fill="white"/>
                    <path d="M135.145 27.5905L137.309 13.2071L142.169 13.9385C143.293 14.1076 144.187 14.4384 144.85 14.9309C145.514 15.4187 145.969 16.021 146.215 16.7381C146.462 17.4551 146.521 18.2373 146.394 19.0848C146.266 19.9322 145.98 20.6576 145.535 21.261C145.09 21.8643 144.481 22.2994 143.708 22.5661C142.936 22.8282 141.993 22.8754 140.878 22.7077L136.945 22.1157L137.182 20.5426L141.059 21.126C141.827 21.2416 142.462 21.2222 142.964 21.068C143.471 20.9144 143.86 20.6475 144.133 20.2671C144.411 19.8828 144.593 19.4027 144.68 18.8268C144.767 18.2509 144.735 17.7314 144.584 17.2682C144.434 16.8051 144.14 16.4209 143.702 16.1156C143.265 15.8056 142.658 15.5921 141.881 15.4752L138.819 15.0143L136.886 27.8527L135.145 27.5905ZM142.887 22.1482L145.455 29.1422L143.432 28.8378L140.921 21.8522L142.887 22.1482Z" fill="white"/>
                    <path d="M160.176 19.747L160.744 18.2914L170.907 22.2586L170.338 23.7141L166.078 22.0508L161.356 34.1449L159.716 33.5043L164.437 21.4103L160.176 19.747Z" fill="white"/>
                    <path d="M183.948 29.2935L176.407 41.7316L174.901 40.8184L182.442 28.3803L183.948 29.2935Z" fill="white"/>
                    <path d="M199.345 45.5126C199.753 44.914 199.859 44.2657 199.664 43.5677C199.468 42.8697 199.038 42.2315 198.374 41.653C197.888 41.2301 197.395 40.9385 196.894 40.7784C196.397 40.6214 195.926 40.5917 195.483 40.6893C195.044 40.79 194.672 41.0154 194.367 41.3652C194.112 41.658 193.963 41.9704 193.918 42.3023C193.881 42.6338 193.912 42.9655 194.012 43.2976C194.115 43.6261 194.249 43.9407 194.414 44.2414C194.582 44.5386 194.745 44.8026 194.902 45.0334L195.754 46.3036C195.975 46.6274 196.202 47.0077 196.437 47.4446C196.676 47.8846 196.856 48.3588 196.978 48.8672C197.107 49.3751 197.123 49.8976 197.026 50.4345C196.928 50.9715 196.656 51.497 196.208 52.0111C195.692 52.6038 195.07 53.004 194.343 53.2119C193.619 53.4228 192.838 53.4112 191.999 53.177C191.165 52.9459 190.326 52.4633 189.483 51.7294C188.698 51.0452 188.128 50.326 187.774 49.5718C187.424 48.8207 187.282 48.0754 187.348 47.3358C187.418 46.5994 187.693 45.9126 188.173 45.2755L189.544 46.4697C189.219 46.915 189.06 47.379 189.066 47.8618C189.079 48.3442 189.216 48.8147 189.475 49.2733C189.742 49.7315 190.093 50.1503 190.528 50.5298C191.035 50.9714 191.562 51.2858 192.109 51.473C192.658 51.6566 193.18 51.7029 193.674 51.6118C194.171 51.5172 194.593 51.27 194.941 50.8701C195.259 50.5059 195.415 50.121 195.411 49.7152C195.406 49.3094 195.3 48.8905 195.092 48.4585C194.885 48.0264 194.635 47.5889 194.343 47.1459L193.329 45.5848C192.687 44.592 192.315 43.6494 192.213 42.757C192.111 41.8647 192.382 41.0489 193.026 40.3099C193.561 39.6958 194.193 39.3049 194.923 39.1371C195.66 38.9689 196.421 39.0038 197.206 39.2417C197.998 39.4791 198.743 39.9026 199.443 40.5122C200.15 41.1279 200.668 41.802 200.997 42.5345C201.329 43.2633 201.466 43.9855 201.408 44.701C201.353 45.4196 201.094 46.0633 200.63 46.6322L199.345 45.5126Z" fill="white"/>
                    <path d="M211.429 55.379L212.688 54.4534L219.151 63.2422L217.892 64.1679L215.182 60.483L204.723 68.1741L203.679 66.7551L214.139 59.0639L211.429 55.379Z" fill="white"/>
                    <path d="M226.326 97.4307L224.828 97.8753L223.017 91.7748L224.515 91.3301L226.326 97.4307Z" fill="white"/>
                </motion.g>
            </svg>

            <motion.svg
                width="260"
                height="260"
                viewBox="0 0 200 200"
                xmlns="http://www.w3.org/2000/svg"
                className="absolute"
            >
                {/* emerge circle */}
                <motion.circle
                    cx="100"
                    cy="100"
                    r="65"
                    fill="none"
                    stroke="#ffffffcc"
                    strokeWidth="30"
                    strokeDasharray={CIRCUM}
                    style={{
                        rotate: -90,
                        strokeDashoffset
                    }}
                    animate={{ opacity: show ? 0 : 1 }}
                    transition={{ duration: 1.5, ease: "easeInOut" }}
                />
            </motion.svg>

            <motion.p
                className="absolute w-[80px] text-center mix-blend-difference z-[10] select-none font-thin"
                animate={{ opacity: show ? 0 : 1 }}
                transition={{ duration: 1.5, ease: "easeInOut" }}
                onPointerDown={() => (isHolding.current = true)}
                onPointerUp={() => (isHolding.current = false)}
                onPointerLeave={() => (isHolding.current = false)}
                onMouseEnter={() => {
                    if (!show) set("hold");
                }}
                onMouseLeave={() => {
                    if (!show) set("default");
                }}
            >
                Hold
            </motion.p>
        </motion.div>
    );
}
